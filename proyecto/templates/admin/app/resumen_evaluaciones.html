{% extends "admin/base_site.html" %}


{% load i18n %}

{% block extrahead %}

{{ block.super }}
<style>
input {
    font-size: 14px;
    font-weight: bold;
    text-align: right;
    margin-right: 20px;
}
img {
    vertical-align: middle;
}
</style>

<script type="text/javascript" src="/static/js/jquery-1.6.2.min.js"></script>
<script type="text/javascript">
    $(document).ready(function(){
	$('#cargando').hide();
	var ids = new Array();
	var cont = 0;
	$('select').each(function(){
	    ids[cont++] = $(this).attr('id');
	});
	/* Actualizacion de los ComboBox */
	$('select').change(function(){
	    var valor = $(this).val()
	    var id = $(this).attr('id');
	    var indice = -1;
	    for (var i=0; i<ids.length; i++){
		if (ids[i] == id){ indice = i; break; }
	    }
	    if (valor == ''){
		return;
	    }
	    $.ajax({
		url: "/admin/resumen/evaluaciones/",
		method: "GET",
		data: {id:id, valor:valor},
		dataType: "JSON",
		success: function (response){
		    /* Limpiamos los select que deben ser cambiados */
		    for (var i=0; i<ids.length; i++){
			if ( i > indice ){
			    $('#' + ids[i]).find('option').remove();
			    $('#' + ids[i]).append(new Option('---------',''));
			}
		    }
		    /* Actualizamos el siguiente campo que le corresponde*/
		    var valores = response['valores'];
		    for (var i=0; i<valores.length; i++){
			var option = new Option(valores[i]['valor'],valores[i]['id']);
			$('#' + response['id']).append(option);
		    }
		},
		error: function(xhr,status,error){
		    alert("error: " + status + "-" + error);
		}
	    });
	});
	/* Calculos de los datos de Resumen */
	$('#calcular').click(function(event){
	    var pa = $('#id_periodo_academico option:selected').val();
	    var c = $('#id_carrera option:selected').val(); 
	    if ( pa != '' &&  c != '') {
		$('#cargando').show();
		$.ajax({
		    method: 'GET',
		    url: '/admin/resumen/calcular',
		    data: {'id_periodo_evaluacion': $('#id_periodo_evaluacion option:selected').val(),
			   'area': $('#id_area option:selected').val(),
			   'carrera': $('#id_carrera option:selected').val(),
			   'semestre': $('#id_semestre option:selected').val(),
			   'paralelo': $('#id_paralelo option:selected').val()
			  },
		    dataType: 'JSON',
		    success: function(response){
			$('#estudiantes').val(response['estudiantes']);
			$('#completados').val(response['completados']);
			$('#faltantes').val(response['faltantes']);
			$('#cargando').hide();
		    },
		    error: function(xhr,status,error){
			alert("error: " + status + "-" + error);
		    }
		});
		event.preventDefault();
	    } // end if != ''
	});
    });
</script>
{% endblock %}

{% block content %}
<table>
{{ form.as_table }}
</table>
<hr/>
<div style="padding-top: 10px;" >
    <button id="calcular" style="margin-right: 40px;"> Calcular </button>
  Total: <input type='text' id='estudiantes' size='10' readonly='readonly'/>
  Han Evaluado: <input type='text' id='completados' size='10' readonly='readonly'/>
  NO Evaluan: <input type='text' id='faltantes' size='10' readonly='readonly'/>
  <br/>
  <img id="cargando" src="/static/images/loading-grey.gif"/>
</div>

{% endblock %}
